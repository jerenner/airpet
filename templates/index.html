<!DOCTYPE html>
<html>
<head>
    <title>GDML Viewer & Editor</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; overflow: hidden; display: flex; }
        #left_panel_container {
            width: 300px; /* Fixed width for now */
            height: 100vh;
            background-color: #e9e9e9; /* Slightly different background */
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Tab headers */
        .tab_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 10px;
            background-color: #d8d8d8;
            border-bottom: 1px solid #ccc;
            font-size: 13px;
            font-weight: bold;
        }

        .tab_header button {
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .tab_header button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Tab Navigation */
        .tab_navigation {
            display: flex;
            border-bottom: 1px solid #ccc;
            background-color: #f8f8f8;
        }
        .tab_button {
            flex-grow: 1;
            padding: 8px 5px; /* Reduced padding for more tabs */
            cursor: pointer;
            border: none;
            border-right: 1px solid #ddd;
            background-color: #f0f0f0;
            font-size: 11px; /* Smaller font for tab buttons */
            text-align: center;
        }
        .tab_button:last-child {
            border-right: none;
        }
        .tab_button.active {
            background-color: #e9e9e9; /* Match panel bg */
            border-bottom: 1px solid #e9e9e9; /* Hide bottom border of active tab */
            font-weight: bold;
        }
        .tab_button:hover {
            background-color: #ddd;
        }

        /* Tab Content Area (will hold hierarchy_panel) */
        .tab_content_area {
            flex-grow: 1; /* Takes up available space for hierarchy */
            overflow-y: auto; /* Scroll within this area */
            background-color: #e9e9e9;
        }
        .tab_pane {
            display: none; /* Hidden by default */
            padding: 10px;
            font-size: 13px;
        }
        .tab_pane.active {
            display: block;
        }
        /* Hierarchy specific styles (same as before) */
        .tab_pane ul { 
            list-style-type: none; 
            /* REMOVE padding-left: 15px; from here to make it flush */
            padding-left: 0;
            margin: 0; 
        }
        .tab_pane li { padding: 3px 0 3px 15px; cursor: pointer; }
        .tab_pane li:hover { background-color: #d8d8d8; } /* Slightly darker hover */
        .tab_pane .selected_item { background-color: #c0d0e0; font-weight: bold; }
        .tab_pane .hidden_item { color: #999; font-style: italic; }
        .tab_pane .toggle { display: inline-block; width: 15px; text-align: center; margin-right: 3px;}

        #inspector_panel {
            height: 300px; /* Fixed height, or use flex-basis for proportions */
            /* flex-basis: 300px; /* Alternative to height if using flex for parent */
            /* flex-shrink: 0; /* Prevent shrinking if content is too much */
            overflow-y: auto;
            padding: 10px;
            border-top: 1px solid #ccc;
            background-color: #fdfdfd; /* Lighter inspector */
        }
        /* ... (inspector_panel h3, .property_item styles remain the same) ... */
        #inspector_panel h3 { margin-top: 0; font-size: 14px; border-bottom: 1px solid #bbb; padding-bottom: 5px;}
        #inspector_panel .property_item { margin-bottom: 8px; }
        #inspector_panel .property_item label {
            display: inline-block;
            width: 90px; /* Adjust as needed */
            font-weight: bold;
            font-size: 12px;
            vertical-align: top;
        }
        #inspector_panel .property_item input[type="text"],
        #inspector_panel .property_item input[type="number"] {
            width: calc(100% - 100px); /* Adjust based on label width */
            padding: 3px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        #inspector_panel button { margin-top: 5px; padding: 3px 8px; font-size: 11px;}
        #inspector_panel .property_item.readonly label {
            font-weight: normal;
            color: #555;
        }
        #inspector_panel .property_item.readonly span {
            color: #000;
            font-family: monospace;
        }


        #main_content_area {
            flex-grow: 1; /* Takes remaining width */
            height: 100vh;
            position: relative; /* For positioning menu bar and viewer */
        }
        #menu_bar { /* Now inside main_content_area */
            position: absolute; top: 0; left: 0; width: 100%;
            background-color: #333; color: white; padding: 0; z-index: 1000; display: flex;
        }
        #menu_bar ul { list-style-type: none; margin: 0; padding: 0; display: flex; }
        #menu_bar li { position: relative; }
        #menu_bar li > button, #menu_bar li > span {
            display: block; color: white; text-align: center; padding: 8px 12px;
            text-decoration: none; border: none; background-color: transparent;
            cursor: pointer; font-size: 14px;
        }
        #menu_bar li > button:hover, #menu_bar li .dropdown_content button:hover { background-color: #555; }
        #menu_bar .dropdown_content {
            display: none; position: absolute; background-color: #f9f9f9; min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1;
        }
        #menu_bar .dropdown_content button {
            color: black; padding: 10px 14px; text-decoration: none; display: block;
            text-align: left; width: 100%; border: none; background-color: transparent; cursor: pointer;
        }
        #menu_bar li:hover .dropdown_content { display: block; }
        #menu_bar button.active_mode { background-color: #007bff; color: white; }

        #viewer_container { /* Now relative within main_content_area */
            width: 100%; height: 100%;
            padding-top: 35px; /* Account for menu bar height */
            box-sizing: border-box;
        }
        canvas { display: block; width: 100% !important; height: 100% !important; }

        /* Solid editor */
        .editor-modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }

        .modal-header {
            padding: 10px 16px;
            background-color: #555;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h4 { margin: 0; }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-body {
            display: flex;
            flex-grow: 1;
            overflow: hidden; /* Prevent body from scrolling */
        }

        .editor-panel {
            padding: 10px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        .editor-panel:last-child { border-right: none; }

        #solid-ingredients-panel { flex: 0 0 200px; overflow-y: auto; }
        #solid-preview-panel { flex: 1 1 auto; padding: 0; position: relative; }
        #solid-params-panel { flex: 0 0 340px; overflow-y: auto; }

        #solid_preview_container {
            width: 100%;
            height: 100%;
            background-color: #e0e0e0;
        }

        .ingredient-list { border-top: 1px solid #ccc; margin-top: 5px; padding-top: 5px;}
        .ingredient-list div { padding: 4px; cursor: grab; border-bottom: 1px solid #eee; }
        .ingredient-list div:hover { background-color: #f0f0f0; }

        #solid-editor-dynamic-params .property_item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        #solid-editor-dynamic-params .property_item label {
            flex-basis: 100px;
            flex-shrink: 0;
        }
        #solid-editor-dynamic-params .property_item input {
            flex-grow: 1;
        }

        /* Boolean specific styles */
        .boolean-slot {
            border: 2px dashed #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            text-align: center;
            color: #888;
            position: relative;
        }
        .boolean-slot h6 { margin: 0 0 5px 0; }
        .boolean-slot.filled {
            border-style: solid;
            border-color: #4CAF50;
            color: #333;
            background-color: #e8f5e9;
        }
        .boolean-slot .remove-solid-btn {
            display: none; /* Hide by default */
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 18px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
        }
        .boolean-slot.filled .remove-solid-btn {
            display: block; /* Show when slot is filled */
        }
        .boolean-slot .remove-solid-btn:hover {
            color: #333;
        }

        .boolean-recipe-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .op-and-slot {
            flex-grow: 1;
        }
        .transform-controls-inline {
            display: flex;
            flex-wrap: wrap; 
            gap: 10px;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dotted #ccc;
        }
        .transform-controls-inline .transform-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .transform-controls-inline .transform-group label {
            font-size: 11px;
            font-weight: bold;
        }
        .transform-controls-inline input {
            width: 50px;
        }
        .remove-op-btn {
            background: none;
            border: none;
            color: #f44336;
            font-size: 20px;
            cursor: pointer;
        }

        /* Boolean transform controls */
        .transform-controls {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 10px;
        }
        .transform-group {
            border: 1px solid #e0e0e0;
            padding: 8px;
            border-radius: 4px;
            flex: 1;
        }
        .transform-group span {
            font-weight: bold;
            font-size: 12px;
            color: #555;
            display: block;
            margin-bottom: 5px;
        }
        .transform-group .property_item label {
            flex-basis: 20px !important; /* Smaller label for X/Y/Z */
        }

        .modal-footer {
            padding: 10px 16px;
            background-color: #f1f1f1;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quick-add-options {
            font-size: 13px;
        }

        /* Re-center button */
        #recenter-solid-preview-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            z-index: 10; /* Ensure it's above the canvas */
            border: 1px solid #999;
            background-color: rgba(240, 240, 240, 0.8);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 18px;
            cursor: pointer;
            line-height: 24px;
        }
        #recenter-solid-preview-btn:hover {
            background-color: rgba(220, 220, 220, 1.0);
        }

        /* Header for selecting defines in inspector panel */
        .define-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .define-header span {
            font-weight: bold;
            font-size: 12px;
            color: #555;
        }
        .define-select {
            max-width: 120px;
        }

        /* Item controls */
        .tree-item-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .item-name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-controls {
            display: none; /* Hidden by default */
            margin-left: 5px;
        }

        /* Show controls only when the list item is hovered */
        li:hover > .tree-item-content > .item-controls {
            display: flex;
        }

        .delete-item-btn {
            background: none;
            border: none;
            color: #f44336;
            font-size: 18px;
            cursor: pointer;
            padding: 0 4px;
            line-height: 1;
        }
        .delete-item-btn:hover {
            color: #c62828;
        }

        /* Visibility controls */
        .visibility-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 0 4px;
        }
        .item-hidden .item-name {
            color: #999;
            font-style: italic;
        }
        .visibility-btn {
            opacity: 1.0; /* Default to visible */
        }

    </style>
</head>
<body>
    <div id="left_panel_container">
        <div class="tab_navigation">
            <button class="tab_button active" data-tab="tab_structure">Structure</button>
            <button class="tab_button" data-tab="tab_lvolumes">L. Volumes</button>
            <button class="tab_button" data-tab="tab_defines">Defines</button>
            <button class="tab_button" data-tab="tab_materials">Materials</button>
            <button class="tab_button" data-tab="tab_solids">Solids</button>
        </div>
        <div class="tab_content_area">
            <div id="tab_structure" class="tab_pane active">
                <!-- Structure (Volumes) Hierarchy will be built here -->
                <div class="tab_header">
                    <span>World Structure</span>
                    <div>
                        <button id="addPVButton" title="Place a volume inside the selected one" disabled>+ PV</button>
                    </div>
                </div>
                <ul id="structure_tree_root"></ul>
            </div>
            <div id="tab_lvolumes" class="tab_pane">
                <div class="tab_header">
                    <span>Logical Volumes</span>
                    <button id="addLVButton" title="Create a new Logical Volume">+ Add LV</button>
                </div>
                <ul id="lvolumes_list_root"></ul>
            </div>
            <div id="tab_defines" class="tab_pane">
                <div class="tab_header">
                    <span>Defines</span>
                    <button class="add_button" data-add-type="define" title="Add new Define">+ Add</button>
                </div>
                <ul id="defines_list_root"></ul>
            </div>
            <div id="tab_materials" class="tab_pane">
                <div class="tab_header">
                    <span>Materials</span>
                    <button class="add_button" data-add-type="material" title="Add new Material">+ Add</button>
                </div>
                <ul id="materials_list_root"></ul>
            </div>
            <div id="tab_solids" class="tab_pane">
                <div class="tab_header">
                    <span>Solids</span>
                    <button class="add_button" data-add-type="solid" title="Add new Solid">+ Add</button>
                </div>
                <ul id="solids_list_root"></ul>
            </div>
        </div>
        <div id="inspector_panel">
            <h3>Inspector</h3>
            <div id="inspector_content">
                <p>Select an item.</p>
            </div>
        </div>
    </div>
    <div id="main_content_area">
        <div id="menu_bar">
            <ul>
                <!-- File Menu -->
                <li>
                    <button>File</button>
                    <div class="dropdown_content">
                        <button id="newProjectButton">New Project</button>
                        <hr style="margin: 5px 0;"> <!-- Separator -->
                        <button id="loadGdmlButton">Load GDML...</button>
                        <input type="file" id="gdmlFile" accept=".gdml,.xml" style="display: none;">
                        <button id="exportGdmlButton">Export GDML...</button>
                        <hr style="margin: 5px 0;"> <!-- Separator -->
                        <button id="saveProjectButton">Save Project (JSON)...</button>
                        <button id="loadProjectButton">Load Project (JSON)...</button>
                        <input type="file" id="projectFile" accept=".json" style="display: none;">
                    </div>
                </li>
                <!-- Edit Menu -->
                <li>
                    <button>Edit</button>
                    <div class="dropdown_content">
                        <button id="toggleSnapToGridButton">Snap to Grid: OFF</button>
                        <div style="padding: 10px; font-size: 12px;">
                            Grid Snap (mm): <input type="number" id="gridSnapSizeInput" value="10" step="any" style="width: 60px;">
                            Angle Snap (deg): <input type="number" id="angleSnapSizeInput" value="1" step="any" style="width: 60px;">
                        </div>
                    </div>
                </li>
                <!-- View Menu -->
                <li>
                    <button>View</button>
                    <div class="dropdown_content">
                        <button id="toggleWireframeButton">Toggle Wireframe</button>
                        <button id="toggleGridButton">Toggle Grid</button>
                        <hr style="margin: 5px 0;"> <!-- Separator -->
                        <button id="cameraModeOrbitButton">Camera: Orbit</button>
                        <button id="cameraModeFlyButton">Camera: Fly</button>
                    </div>
                </li>
                <!-- Object Menu -->
                <li>
                    <button>Object</button>
                    <div class="dropdown_content">
                        <!--<button id="addObjectButton">Add...</button>-->
                        <button id="deleteSelectedObjectButton">Delete Selected</button>
                        <button id="hideSelectedBtn">Hide Selected</button>
                        <button id="showAllBtn">Show All</button>
                    </div>
                </li>
                <!-- Mode Menu -->
                <li>
                    <button>Mode</button>
                    <div class="dropdown_content">
                        <button id="modeObserveButton" class="active_mode">Observe</button>
                        <button id="modeTranslateButton">Translate</button> <!-- Renamed from Move -->
                        <button id="modeRotateButton">Rotate</button>
                        <!-- <button id="modeScaleButton">Scale</button>--> <!-- Optional for future -->
                    </div>
                </li>
                <li><span id="currentModeDisplay" style="padding: 8px 12px; font-style: italic;">Mode: Observe</span></li>
            </ul>
        </div>
        <div id="viewer_container"></div>
        <!-- Old floating info panel -->
        <!--<div id="info_panel">
            <h3>Object Information</h3>
            <p><strong>Name:</strong> <span id="info_name">-</span></p>
            <p><strong>Type:</strong> <span id="info_type">-</span></p>
            <p><strong>Parameters:</strong></p>
            <div id="info_parameters" style="padding-left: 10px;">-</div>
            <p><strong>Position (mm):</strong></p>
            <div id="info_position" style="padding-left: 10px;">-</div>
            <p><strong>Rotation (rad, ZYX):</strong></p>
            <div id="info_rotation" style="padding-left: 10px;">-</div>
        </div>-->
        <div id="addObjectModal" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:white; padding:20px; border:1px solid #ccc; z-index:1001;">
            <h4>Add New Object</h4>
            <label for="newObjectType">Type:</label>
            <select id="newObjectType">
                <option value="define_position">Define: Position</option>
                <option value="define_rotation">Define: Rotation</option>
                <option value="material">Material</option>
                <option value="solid_box">Solid: Box</option>
                <option value="solid_tube">Solid: Tube</option>
                <!-- Add more solid types -->
                <option value="logical_volume" disabled>Logical Volume (select solid/mat)</option> <!-- Disabled for now -->
                <option value="physical_volume" disabled>Physical Volume (select LV/parent)</option> <!-- Disabled for now -->
            </select>
            <br><br>
            <label for="newObjectName">Name:</label>
            <input type="text" id="newObjectName" placeholder="e.g., MyNewBox">
            <br><br>
            <!-- Fields for parameters will be added dynamically by JS -->
            <div id="newObjectParams"></div>
            <br>
            <button id="confirmAddObject">Add</button>
            <button id="cancelAddObject">Cancel</button>
        </div>
        <div id="modalBackdrop" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;"></div>
    </div>
    <!-- Editor for defines -->
    <div id="defineEditorModal" class="editor-modal">
        <div class="modal-content" style="width: 400px; height: auto;">
            <div class="modal-header">
                <h4 id="defineEditorTitle">Create New Define</h4>
            </div>
            <div class="modal-body" style="flex-direction: column;">
                <div class="property_item">
                    <label for="defineEditorName">Name:</label>
                    <input type="text" id="defineEditorName" placeholder="e.g., TargetPosition">
                </div>
                <div class="property_item">
                    <label for="defineEditorType">Type:</label>
                    <select id="defineEditorType">
                        <option value="position">Position</option>
                        <option value="rotation">Rotation</option>
                        <option value="scale">Scale</option>
                        <option value="constant">Constant</option>
                    </select>
                </div>
                <hr>
                <div id="define-editor-params"></div>
            </div>
            <div class="modal-footer">
                <button id="defineEditorCancel">Cancel</button>
                <button id="defineEditorConfirm" class="confirm-button">Create</button>
            </div>
        </div>
    </div>
    <!-- Editor for materials -->
    <div id="materialEditorModal" class="editor-modal">
        <div class="modal-content" style="width: 600px; height: auto;">
            <div class="modal-header">
                <h4 id="materialEditorTitle">Create New Material</h4>
            </div>
            <div class="modal-body" style="flex-direction: column;">
                <div class="property_item">
                    <label for="materialEditorName">Name:</label>
                    <input type="text" id="materialEditorName" placeholder="e.g., G4_WATER">
                </div>
                
                <!-- Radio buttons to switch definition type -->
                <div class="property_item">
                    <label>Definition:</label>
                    <input type="radio" name="mat_type" value="simple" id="mat_type_simple" checked> <label for="mat_type_simple">Simple Element</label>
                    <input type="radio" name="mat_type" value="mixture" id="mat_type_mixture"> <label for="mat_type_mixture">Mixture/Compound</label>
                </div>
                <hr>

                <!-- Parameters section -->
                <div id="material-editor-params">
                    <!-- Content will be generated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="materialEditorCancel">Cancel</button>
                <button id="materialEditorConfirm" class="confirm-button">Create</button>
            </div>
        </div>
    </div>
    <!-- Editor for solids -->
    <div id="solidEditorModal" class="editor-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="solidEditorTitle">Create New Solid</h4>
                <span class="close-button" id="closeSolidEditor">×</span>
            </div>
            <div class="modal-body">
                <!-- Left Panel: For Boolean ingredients -->
                <div class="editor-panel" id="solid-ingredients-panel">
                    <h5>Existing Solids</h5>
                    <div id="boolean-ingredients-list" class="ingredient-list">
                        <!-- List of solids will be populated here by JS -->
                    </div>
                </div>

                <!-- Center Panel: 3D Preview -->
                <div class="editor-panel" id="solid-preview-panel">
                    <div id="solid_preview_container">
                        <!-- The new Three.js canvas will go here -->
                    </div>
                    <button id="recenter-solid-preview-btn" title="Recenter View">↺</button>
                </div>

                <!-- Right Panel: Parameters -->
                <div class="editor-panel" id="solid-params-panel">
                    <h5>Parameters</h5>
                    <div class="property_item">
                        <label for="solidEditorName">Name:</label>
                        <input type="text" id="solidEditorName" placeholder="e.g., MyNewBox">
                    </div>
                    <div class="property_item">
                        <label for="solidEditorType">Type:</label>
                        <select id="solidEditorType">
                            <optgroup label="Primitives">
                                <option value="box">Box</option>
                                <option value="tube">Tube</option>
                                <option value="cone">Cone</option>
                                <option value="sphere">Sphere</option>
                                <option value="orb">Orb (Sphere)</option>
                                <option value="torus">Torus</option>
                                <option value="trd">Trd (Trapezoid)</option>
                                <option value="para">Para (Parallelepiped)</option>
                                <option value="eltube">Elliptical Tube</option>
                                <!-- Add other primitives here -->
                            </optgroup>
                            <!-- Single "Boolean" option -->
                            <optgroup label="Composites">
                                <option value="boolean">Boolean</option>
                            </optgroup>
                        </select>
                    </div>
                    <hr>
                    <!-- Dynamic parameters based on type selection -->
                    <div id="solid-editor-dynamic-params"></div>
                </div>
            </div>
            <div class="modal-footer">
                <!-- NEW: Streamlined creation options -->
                <div class="quick-add-options">
                    <input type="checkbox" id="createLVCheckbox">
                    <label for="createLVCheckbox">Create Logical Volume</label>
                    <div id="lvOptions" style="display:none; margin-left: 20px;">
                        <select id="lvMaterialSelect"></select>
                    </div>
                    <br>
                    <input type="checkbox" id="placePVCheckbox" disabled>
                    <label for="placePVCheckbox">Place in Selected Volume</label>
                </div>
                <button id="confirmSolidEditor" class="confirm-button">Create Solid</button>
            </div>
        </div>
    </div>
    <!-- Editor modal for logical volumes -->
    <div id="lvEditorModal" class="editor-modal">
        <div class="modal-content" style="width: 500px; height: auto;">
            <div class="modal-header">
                <h4 id="lvEditorTitle">Create New Logical Volume</h4>
                <span class="close-button" id="closeLVEditor">×</span>
            </div>
            <div class="modal-body" style="flex-direction: column;">
                <div class="property_item">
                    <label for="lvEditorName">Name:</label>
                    <input type="text" id="lvEditorName" placeholder="e.g., myDetectorLV">
                </div>
                <div class="property_item">
                    <label for="lvEditorSolid">Solid:</label>
                    <select id="lvEditorSolid"></select>
                </div>
                <div class="property_item">
                    <label for="lvEditorMaterial">Material:</label>
                    <select id="lvEditorMaterial"></select>
                </div>
                <div class="property_item">
                    <label for="lvEditorColor">Color:</label>
                    <input type="color" id="lvEditorColor" value="#cccccc">
                    <label for="lvEditorAlpha" style="width:auto; margin-left:10px;">Opacity:</label>
                    <input type="range" id="lvEditorAlpha" min="0" max="1" step="0.05" value="0.5">
                </div>
                <!-- Placeholders for future additions -->
                <hr>
                <p style="text-align:center; color:#888;"><i>Sensitive Detector, User Limits can be added here later.</i></p>
            </div>
            <div class="modal-footer">
                <button id="confirmLVEditor" class="confirm-button">Create LV</button>
            </div>
        </div>
    </div>
    <!-- Editor modal for physical volumes -->
    <div id="pvEditorModal" class="editor-modal">
        <div class="modal-content" style="width: 500px; height: auto;">
            <div class="modal-header">
                <h4 id="pvEditorTitle">Place New Physical Volume</h4>
            </div>
            <div class="modal-body" style="flex-direction: column;">
                <div class="property_item">
                    <label for="pvEditorName">Placement Name:</label>
                    <input type="text" id="pvEditorName" placeholder="e.g., myDetectorPlacement_1">
                </div>
                <div class="property_item">
                    <label for="pvEditorLV">Logical Volume:</label>
                    <select id="pvEditorLV"></select>
                </div>
                <hr>
                <div class="transform-controls">
                    <div class="transform-group">
                        <div class="define-header">
                            <span>Position (mm)</span>
                            <select id="pv_pos_define_select" class="define-select"></select>
                        </div>
                        <div class="property_item"><label for="pv_pos_x">X:</label><input type="number" id="pv_pos_x" class="abs-input" value="0" step="any"></div>
                        <div class="property_item"><label for="pv_pos_y">Y:</label><input type="number" id="pv_pos_y" class="abs-input" value="0" step="any"></div>
                        <div class="property_item"><label for="pv_pos_z">Z:</label><input type="number" id="pv_pos_z" class="abs-input" value="0" step="any"></div>
                    </div>
                    <div class="transform-group">
                        <div class="define-header">
                            <span>Rotation (deg, ZYX)</span>
                            <select id="pv_rot_define_select" class="define-select"></select>
                        </div>
                        <div class="property_item"><label for="pv_rot_x">X:</label><input type="number" id="pv_rot_x" class="abs-input" value="0" step="any"></div>
                        <div class="property_item"><label for="pv_rot_y">Y:</label><input type="number" id="pv_rot_y" class="abs-input" value="0" step="any"></div>
                        <div class="property_item"><label for="pv_rot_z">Z:</label><input type="number" id="pv_rot_z" class="abs-input" value="0" step="any"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <!-- Add a close button -->
                <button id="cancelPVEditor">Cancel</button>
                <button id="confirmPVEditor" class="confirm-button">Place Volume</button>
            </div>
        </div>
    </div>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "three-mesh-bvh": "https://unpkg.com/three-mesh-bvh@0.9.0/build/index.module.js",
            "three-bvh-csg": "https://unpkg.com/three-bvh-csg@0.0.16/build/index.module.js"
        }
    }
    </script>
    <script type="module" src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>